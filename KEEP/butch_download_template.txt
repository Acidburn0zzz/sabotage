#!/bin/sh
%BUTCH_CONFIG
retries=5
butch_cache_dir="$C"
tmp=/tmp/butchdl.$$
rc=0
wget --help 2>&1 | grep BusyBox || retryf="--tries=$retries"
echo "in case the download process was killed, see $tmp for wget output"
for url in %BUTCH_MIRROR_URLS ; do
if ! wget -O "$butch_cache_dir/%BUTCH_TARBALL.wip" -c "$url" \
  $wgetflags $retryf 2>$tmp ; then
	rc=1
	grep 404 < $tmp > /dev/null && rc=44
	cat $tmp
	rm $tmp
else
	mv "$butch_cache_dir"/"%BUTCH_TARBALL".wip \
	   "$butch_cache_dir"/"%BUTCH_TARBALL"
	rc=0
	break
fi
done
cat $tmp
rm $tmp
exit $rc
