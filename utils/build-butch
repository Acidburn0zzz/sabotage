#!/bin/sh

tarxf http://mirror.wzff.de/butch/ butch-0.1.0 .tar.bz2 butch

filesize='61306'
sha512='e5bf1e307ecd25cb9397e5f789201b1888f4ce2362a1c1313f15173aec464c9972b3515a1b659a6c579a1efd7e4a306a69c5c5bfaa0766f5b9072f2c3c8d2026'

filename="$S"/butch-0.1.0.tar.bz2

read sz _ <<EOF
$(du -b "$filename")
EOF

if [ "$sz" != "$filesize" ]; then
    printf -- "error: build-butch: wrong filesize. got: %d expected: %d\n" "$sz" "$filesize"
    exit 1
fi

read sha _ <<EOF
$(sha512sum "$filename")
EOF

if [ "$sha" != "$sha512" ]; then
    printf -- "error: build-butch: hash doesn't match.\n"
    exit 1
fi

# this speeds up compilation a bit
echo "CFLAGS=-O0 -g" > lib/config.mak
./build.sh
cp butch/butch "$S"/butch.bin
cp "$filename" "$C"/

